<mxfile host="app.diagrams.net" modified="2020-07-18T14:59:16.872Z" agent="5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36" etag="YWP3RrI_lmJy1rbmNA30" version="13.4.2" type="github">
  <diagram id="71aa756b-deb0-e7b1-39c7-49fa7107dbdd" name="Page-1">
    <mxGraphModel dx="1416" dy="828" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="0" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" background="#ffffff" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" style="" parent="0" />
        <mxCell id="286" value="click install apk in FileExplorer" style="shape=step;perimeter=stepPerimeter;whiteSpace=wrap;html=1;fixedSize=1;align=center;size=10;fillColor=#97D077;strokeColor=none;fontColor=#FFFFFF;" parent="1" vertex="1">
          <mxGeometry x="40" y="40" width="200" height="20" as="geometry" />
        </mxCell>
        <mxCell id="VTfqvs8XMtmZEZF2U0ne-447" value="" style="endArrow=none;html=1;strokeColor=#BBBBBB;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1440" y="1270" as="sourcePoint" />
            <mxPoint x="1440" y="80" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="VTfqvs8XMtmZEZF2U0ne-448" value="&lt;font face=&quot;helvetica&quot;&gt;-&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;shadow=0;glass=0;comic=0;startSize=20;fontColor=#BBBBBB;" parent="1" vertex="1">
          <mxGeometry x="1450" y="80" width="115" height="20" as="geometry" />
        </mxCell>
        <mxCell id="lEKasSIzpFkO7wcDi95Z-328" value="&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;main&lt;/span&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=right;verticalAlign=middle;whiteSpace=wrap;rounded=0;shadow=0;glass=0;comic=0;startSize=20;fontColor=#BBBBBB;" parent="1" vertex="1">
          <mxGeometry x="1320" y="80" width="115" height="20" as="geometry" />
        </mxCell>
        <mxCell id="xOQtw8MwqIaRuGbksqcK-329" value="" style="line;strokeWidth=4;direction=south;html=1;perimeter=backbonePerimeter;points=[];outlineConnect=0;rounded=0;shadow=0;glass=0;comic=0;startSize=20;fillColor=none;fontColor=#BBBBBB;align=left;strokeColor=#BBBBBB;" parent="1" vertex="1">
          <mxGeometry x="1475" y="40" width="10" height="2040" as="geometry" />
        </mxCell>
        <mxCell id="xOQtw8MwqIaRuGbksqcK-330" value="&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;com.android.packageinstaller&lt;/span&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=right;verticalAlign=middle;whiteSpace=wrap;rounded=0;shadow=0;glass=0;comic=0;startSize=20;fontColor=#BBBBBB;" parent="1" vertex="1">
          <mxGeometry x="1360" y="40" width="115" height="20" as="geometry" />
        </mxCell>
        <mxCell id="xOQtw8MwqIaRuGbksqcK-331" value="system_server" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;shadow=0;glass=0;comic=0;startSize=20;fontColor=#BBBBBB;" parent="1" vertex="1">
          <mxGeometry x="1485" y="40" width="115" height="20" as="geometry" />
        </mxCell>
        <mxCell id="yb1TY8jY7eYrYFV5jX-Z-288" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;startArrow=oval;startFill=1;strokeColor=#9673a6;fillColor=#e1d5e7;" parent="1" source="xqv6QPp65D5jO_ZpHdb--286" target="yb1TY8jY7eYrYFV5jX-Z-287" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="xqv6QPp65D5jO_ZpHdb--286" value="&lt;span&gt;&lt;div&gt;&lt;font color=&quot;#ffb570&quot;&gt;frameworks\base\packages\PackageInstaller\src\com\android\packageinstaller\PackageInstallerActivity.java&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; protected void onCreate(Bundle icicle) {&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; String storage_path = intent.getStringExtra(&quot;STORAGE_PATH&quot;);&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; prepareProcess(intent, packageUri);&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/span&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;shadow=0;glass=0;comic=0;startSize=20;labelPosition=center;verticalLabelPosition=middle;horizontal=1;fontColor=#000000;movable=1;resizable=1;rotatable=1;deletable=1;editable=1;connectable=1;" parent="1" vertex="1">
          <mxGeometry x="400" y="690" width="120" height="70" as="geometry" />
        </mxCell>
        <mxCell id="xqv6QPp65D5jO_ZpHdb--291" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;startArrow=oval;startFill=1;strokeColor=#9673a6;fillColor=#e1d5e7;" parent="1" source="xqv6QPp65D5jO_ZpHdb--287" target="xqv6QPp65D5jO_ZpHdb--286" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="xqv6QPp65D5jO_ZpHdb--287" value="&lt;div&gt;&lt;font color=&quot;#ffb570&quot;&gt;frameworks\base\packages\PackageInstaller\src\com\android\packageinstaller\DeleteStagedFileOnResult.java&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;public class DeleteStagedFileOnResult extends Activity {&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; @Override&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; protected void onCreate(@Nullable Bundle savedInstanceState) {&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (savedInstanceState == null) {&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Intent installIntent = new Intent(getIntent());&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (AppOpsUtilsCompat.isXOptMode()) {&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; installIntent.setClass(this, PackageInstallerActivityOrigin.class);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; } else{&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; installIntent.setClass(this, &lt;/font&gt;PackageInstallerActivity.class&lt;font color=&quot;#999999&quot;&gt;);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; installIntent.putExtra(&quot;STORAGE_PATH&quot;,getIntent().getStringExtra(&quot;STORAGE_PATH&quot;));&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; installIntent.setFlags(Intent.FLAG_ACTIVITY_NO_ANIMATION);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; startActivityForResult(installIntent, 0);&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;shadow=0;glass=0;comic=0;startSize=20;labelPosition=center;verticalLabelPosition=middle;horizontal=1;fontColor=#000000;movable=1;resizable=1;rotatable=1;deletable=1;editable=1;connectable=1;" parent="1" vertex="1">
          <mxGeometry x="280" y="470" width="120" height="210" as="geometry" />
        </mxCell>
        <mxCell id="xqv6QPp65D5jO_ZpHdb--290" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;startArrow=oval;startFill=1;strokeColor=#9673a6;fillColor=#e1d5e7;" parent="1" source="xqv6QPp65D5jO_ZpHdb--288" target="xqv6QPp65D5jO_ZpHdb--287" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="xqv6QPp65D5jO_ZpHdb--288" value="&lt;div&gt;&lt;font color=&quot;#ffb570&quot;&gt;frameworks\base\packages\PackageInstaller\src\com\android\packageinstaller\InstallStaging.java&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; @Override&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; protected void onPostExecute(Boolean success) {&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (success) {&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; // Now start the installation again from a file&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Intent installIntent = new Intent(getIntent());&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; installIntent.setClass(InstallStaging.this, &lt;/font&gt;DeleteStagedFileOnResult.class&lt;font color=&quot;#999999&quot;&gt;);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; installIntent.setData(Uri.fromFile(mStagedFile));&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; installIntent.putExtra(&lt;/font&gt;&lt;font color=&quot;#009900&quot;&gt;&quot;STORAGE_PATH&quot;&lt;/font&gt;&lt;font color=&quot;#999999&quot;&gt;,getIntent().getData().toString());&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (installIntent.getBooleanExtra(Intent.EXTRA_RETURN_RESULT, false)) {&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; installIntent.addFlags(Intent.FLAG_ACTIVITY_FORWARD_RESULT);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; installIntent.addFlags(Intent.FLAG_ACTIVITY_NO_ANIMATION);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; startActivity(installIntent);&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;shadow=0;glass=0;comic=0;startSize=20;labelPosition=center;verticalLabelPosition=middle;horizontal=1;fontColor=#000000;movable=1;resizable=1;rotatable=1;deletable=1;editable=1;connectable=1;" parent="1" vertex="1">
          <mxGeometry x="160" y="250" width="120" height="220" as="geometry" />
        </mxCell>
        <mxCell id="-hxafRc9YYkVESbqxfg_-287" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;startArrow=oval;startFill=1;strokeColor=#9673a6;fillColor=#e1d5e7;" parent="1" source="-hxafRc9YYkVESbqxfg_-286" target="xqv6QPp65D5jO_ZpHdb--288" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-hxafRc9YYkVESbqxfg_-286" value="&lt;span&gt;&lt;div&gt;&lt;font color=&quot;#ffb570&quot;&gt;frameworks\base\packages\PackageInstaller\src\com\android\packageinstaller\InstallStaging.java&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; protected void onResume() {&lt;/div&gt;&lt;div&gt;&lt;span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; // This is the first onResume in a single life of the activity&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (mStagingTask == null) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; // File does not exist, or became invalid&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (mStagedFile == null) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; // Create file delayed to be able to show error&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; try {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; mStagedFile = TemporaryFileManager.getStagedFile(this);&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; mStagingTask = new StagingAsyncTask();&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; mStagingTask.execute(getIntent().getData());&lt;/div&gt;&lt;/font&gt;&lt;/div&gt;&lt;/span&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;shadow=0;glass=0;comic=0;startSize=20;labelPosition=center;verticalLabelPosition=middle;horizontal=1;fontColor=#000000;movable=1;resizable=1;rotatable=1;deletable=1;editable=1;connectable=1;" parent="1" vertex="1">
          <mxGeometry x="40" y="70" width="120" height="180" as="geometry" />
        </mxCell>
        <mxCell id="-hxafRc9YYkVESbqxfg_-288" value="&lt;span&gt;target&amp;nbsp; &amp;nbsp; =/data/app/vmdl1871514791.tmp/PackageInstaller&lt;br&gt;stageDir=&lt;/span&gt;&lt;span&gt;/data/app/vmdl1871514791.tmp&lt;br&gt;&lt;/span&gt;&lt;span&gt;name&amp;nbsp; &amp;nbsp; =PackageInstaller&lt;br&gt;&lt;/span&gt;" style="text;html=1;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=top;rounded=1;shadow=0;glass=0;comic=0;startSize=20;labelPosition=center;verticalLabelPosition=middle;horizontal=1;movable=1;resizable=1;rotatable=1;deletable=1;editable=1;connectable=1;arcSize=14;" parent="1" vertex="1">
          <mxGeometry x="1970" y="1150" width="320" height="50" as="geometry" />
        </mxCell>
        <mxCell id="yb1TY8jY7eYrYFV5jX-Z-287" value="&lt;span&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&amp;nbsp; &amp;nbsp; private void prepareProcess(final Intent intent, final Uri packageUri) {&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; mWorkerRunnable = new Runnable() {&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; @Override&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; public void run() {&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; boolean processResult = processPackageUri(packageUri);&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;/span&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;shadow=0;glass=0;comic=0;startSize=20;labelPosition=center;verticalLabelPosition=middle;horizontal=1;fontColor=#000000;movable=1;resizable=1;rotatable=1;deletable=1;editable=1;connectable=1;" parent="1" vertex="1">
          <mxGeometry x="520" y="770" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="yb1TY8jY7eYrYFV5jX-Z-304" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;startArrow=oval;startFill=1;strokeColor=#9673a6;fillColor=#e1d5e7;dashed=1;" parent="1" source="yb1TY8jY7eYrYFV5jX-Z-289" target="yb1TY8jY7eYrYFV5jX-Z-292" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="700" y="1160" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="yb1TY8jY7eYrYFV5jX-Z-289" value="&lt;div style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&amp;nbsp; &amp;nbsp; private boolean processPackageUri(final Uri packageUri) {&lt;/div&gt;&lt;div style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; mPackageURI = packageUri;&lt;/div&gt;&lt;div style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; final String scheme = packageUri.getScheme();&lt;/div&gt;&lt;div style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; switch (scheme) {&lt;/div&gt;&lt;div style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; case SCHEME_PACKAGE: {&lt;/div&gt;&lt;div style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&lt;span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; break;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; case &lt;/font&gt;&lt;font color=&quot;#009900&quot;&gt;ContentResolver.SCHEME_FILE&lt;/font&gt;&lt;font color=&quot;#999999&quot;&gt;: {&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; File sourceFile = new File(packageUri.getPath());&lt;/div&gt;&lt;div&gt;&lt;div style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (Build.VERSION.SDK_INT &amp;gt; 27) {&lt;/div&gt;&lt;div style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Class&amp;lt;?&amp;gt;[] parameterTypes = new Class[]{&lt;/div&gt;&lt;div style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Class.forName(&quot;android.content.pm.PackageParser$Package&quot;), boolean.class};&lt;/div&gt;&lt;div style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; ReflectUtilHelper.callStaticObjectMethod(TAG, Class.forName(&quot;android.content.pm.PackageParser&quot;)&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; ,&quot;&lt;/font&gt;collectCertificates&lt;font color=&quot;#999999&quot;&gt;&quot;, parameterTypes, parsed, false);&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; mPkgInfo = PackageParserCompat.generatePackageInfo(parsed, null,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; PackageManager.GET_PERMISSIONS | PackageManager.GET_META_DATA | PackageManager.GET_SIGNATURES, 0, 0, null,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; PackageParserCompat.createPackageUserState());&lt;/div&gt;&lt;div style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; mAppSnippet = PackageUtil.getAppSnippet(this, mPkgInfo.applicationInfo, sourceFile);&lt;/div&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;shadow=0;glass=0;comic=0;startSize=20;labelPosition=center;verticalLabelPosition=middle;horizontal=1;fontColor=#000000;movable=1;resizable=1;rotatable=1;deletable=1;editable=1;connectable=1;" parent="1" vertex="1">
          <mxGeometry x="640" y="850" width="120" height="270" as="geometry" />
        </mxCell>
        <mxCell id="yb1TY8jY7eYrYFV5jX-Z-290" value="&lt;span&gt;&lt;div&gt;&lt;span&gt;file:///data/user_de/0/com.android.packageinstaller/no_backup/package3588840491720825614.apk&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;/span&gt;" style="text;html=1;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=top;rounded=1;shadow=0;glass=0;comic=0;startSize=20;labelPosition=center;verticalLabelPosition=middle;horizontal=1;movable=1;resizable=1;rotatable=1;deletable=1;editable=1;connectable=1;arcSize=20;" parent="1" vertex="1">
          <mxGeometry x="830" y="870" width="540" height="20" as="geometry" />
        </mxCell>
        <mxCell id="yb1TY8jY7eYrYFV5jX-Z-291" value="&lt;span&gt;认证签名信息&lt;br&gt;&lt;/span&gt;" style="text;html=1;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=top;rounded=1;shadow=0;glass=0;comic=0;startSize=20;labelPosition=center;verticalLabelPosition=middle;horizontal=1;movable=1;resizable=1;rotatable=1;deletable=1;editable=1;connectable=1;arcSize=20;" parent="1" vertex="1">
          <mxGeometry x="620" y="1020" width="90" height="30" as="geometry" />
        </mxCell>
        <mxCell id="yb1TY8jY7eYrYFV5jX-Z-295" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;startArrow=oval;startFill=1;strokeColor=#9673a6;fillColor=#e1d5e7;" parent="1" source="yb1TY8jY7eYrYFV5jX-Z-292" target="yb1TY8jY7eYrYFV5jX-Z-294" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="yb1TY8jY7eYrYFV5jX-Z-292" value="&lt;span&gt;&lt;div&gt;&lt;font color=&quot;#ffb570&quot;&gt;frameworks\base\packages\PackageInstaller\src\com\android\packageinstaller\PackageInstallerActivity.java&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&amp;nbsp; &amp;nbsp; public void onClick(View v) {&lt;/div&gt;&lt;div style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (v == mOk || v == mInstallButton) {&lt;/div&gt;&lt;div style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (mSessionId != -1) {&lt;/div&gt;&lt;div style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&lt;span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; } else {&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (mIsSystemPackage) {&lt;/div&gt;&lt;div style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&lt;span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }else {&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; startInstall();&lt;/div&gt;&lt;/div&gt;&lt;/span&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;shadow=0;glass=0;comic=0;startSize=20;labelPosition=center;verticalLabelPosition=middle;horizontal=1;fontColor=#000000;movable=1;resizable=1;rotatable=1;deletable=1;editable=1;connectable=1;" parent="1" vertex="1">
          <mxGeometry x="40" y="1180" width="120" height="120" as="geometry" />
        </mxCell>
        <mxCell id="yb1TY8jY7eYrYFV5jX-Z-293" value="click install button" style="shape=step;perimeter=stepPerimeter;whiteSpace=wrap;html=1;fixedSize=1;align=center;size=10;fillColor=#97D077;strokeColor=none;fontColor=#FFFFFF;" parent="1" vertex="1">
          <mxGeometry x="40" y="1120" width="130" height="20" as="geometry" />
        </mxCell>
        <mxCell id="yb1TY8jY7eYrYFV5jX-Z-300" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;startArrow=oval;startFill=1;strokeColor=#9673a6;fillColor=#e1d5e7;" parent="1" source="yb1TY8jY7eYrYFV5jX-Z-294" target="yb1TY8jY7eYrYFV5jX-Z-297" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="yb1TY8jY7eYrYFV5jX-Z-294" value="&lt;div&gt;&lt;span style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&amp;nbsp; &amp;nbsp; private void startInstall() {&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; // Start subactivity to actually install the application&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Intent newIntent = new Intent();&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; newIntent.setClass(this, &lt;/font&gt;InstallInstalling.class&lt;font color=&quot;#999999&quot;&gt;);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; startActivity(newIntent);&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;shadow=0;glass=0;comic=0;startSize=20;labelPosition=center;verticalLabelPosition=middle;horizontal=1;fontColor=#000000;movable=1;resizable=1;rotatable=1;deletable=1;editable=1;connectable=1;" parent="1" vertex="1">
          <mxGeometry x="160" y="1300" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="yb1TY8jY7eYrYFV5jX-Z-301" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;startArrow=oval;startFill=1;strokeColor=#9673a6;fillColor=#e1d5e7;" parent="1" source="yb1TY8jY7eYrYFV5jX-Z-297" target="yb1TY8jY7eYrYFV5jX-Z-299" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="yb1TY8jY7eYrYFV5jX-Z-297" value="&lt;span&gt;&lt;div&gt;&lt;font color=&quot;#ffb570&quot;&gt;frameworks\base\packages\PackageInstaller\src\com\android\packageinstaller\InstallInstalling.java&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; protected void onCreate(@Nullable Bundle savedInstanceState) {&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (&quot;package&quot;.equals(mPackageURI.getScheme())) {&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; } else {&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; final File sourceFile = new File(mPackageURI.getPath());&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; mAppSnippet = PackageUtil.getAppSnippet(this, appInfo, sourceFile);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (savedInstanceState != null) {&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; } else {&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; PackageInstaller.SessionParams &lt;/font&gt;params &lt;font color=&quot;#999999&quot;&gt;= new PackageInstaller.SessionParams(&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; PackageInstaller.SessionParams.MODE_FULL_INSTALL);&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;params&lt;font color=&quot;#999999&quot;&gt;.setInstallAsInstantApp(false);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;params&lt;font color=&quot;#999999&quot;&gt;.setReferrerUri(getIntent().getParcelableExtra(Intent.EXTRA_REFERRER));&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;params&lt;font color=&quot;#999999&quot;&gt;.setOriginatingUri(getIntent()&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .getParcelableExtra(Intent.EXTRA_ORIGINATING_URI));&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;params&lt;font color=&quot;#999999&quot;&gt;.setOriginatingUid(getIntent().getIntExtra(Intent.EXTRA_ORIGINATING_UID,&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; UID_UNKNOWN));&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;params&lt;font color=&quot;#999999&quot;&gt;.setInstallerPackageName(getIntent().getStringExtra(&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Intent.EXTRA_INSTALLER_PACKAGE_NAME));&lt;/div&gt;&lt;div style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; params.setInstallReason(PackageManager.INSTALL_REASON_USER);&lt;/div&gt;&lt;div style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; File file = new File(mPackageURI.getPath());&lt;/div&gt;&lt;div style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; try {&lt;/div&gt;&lt;div style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; PackageParser.PackageLite pkg = PackageParser.parsePackageLite(file, 0);&lt;/div&gt;&lt;div style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; params.setAppPackageName(pkg.packageName);&lt;/div&gt;&lt;div style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; params.setInstallLocation(pkg.installLocation);&lt;/div&gt;&lt;div style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; params.setSize(&lt;/div&gt;&lt;div style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; PackageHelper.calculateInstalledSize(pkg, false, params.abiOverride));&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; try {&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; mInstallId = InstallEventReceiver&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .addObserver(this, EventResultPersister.GENERATE_NEW_ID,&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; this::launchFinishBasedOnResult);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; } catch (EventResultPersister.OutOfIdsException e) {&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; launchFailure(PackageManager.INSTALL_FAILED_INTERNAL_ERROR, null);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; try {&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; mSessionId = getPackageManager().getPackageInstaller().createSession(&lt;font color=&quot;#ff0000&quot;&gt;params&lt;/font&gt;);&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/span&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;shadow=0;glass=0;comic=0;startSize=20;labelPosition=center;verticalLabelPosition=middle;horizontal=1;fontColor=#000000;movable=1;resizable=1;rotatable=1;deletable=1;editable=1;connectable=1;" parent="1" vertex="1">
          <mxGeometry x="280" y="1380" width="120" height="540" as="geometry" />
        </mxCell>
        <mxCell id="yb1TY8jY7eYrYFV5jX-Z-306" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;startArrow=oval;startFill=1;strokeColor=#9673a6;fillColor=#e1d5e7;" parent="1" source="yb1TY8jY7eYrYFV5jX-Z-298" target="yb1TY8jY7eYrYFV5jX-Z-305" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="yb1TY8jY7eYrYFV5jX-Z-298" value="&lt;span&gt;&lt;div&gt;&lt;font color=&quot;#ffb570&quot;&gt;frameworks\base\services\core\java\com\android\server\pm\PackageInstallerService.java&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; public int createSession(SessionParams params, String installerPackageName, int userId) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; try {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return createSessionInternal(params, installerPackageName, userId);&lt;/div&gt;&lt;/font&gt;&lt;/div&gt;&lt;/span&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;shadow=0;glass=0;comic=0;startSize=20;labelPosition=center;verticalLabelPosition=middle;horizontal=1;fontColor=#000000;movable=1;resizable=1;rotatable=1;deletable=1;editable=1;connectable=1;" parent="1" vertex="1">
          <mxGeometry x="1600" y="80" width="120" height="70" as="geometry" />
        </mxCell>
        <mxCell id="yb1TY8jY7eYrYFV5jX-Z-302" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;startArrow=oval;startFill=1;strokeColor=#9673a6;fillColor=#e1d5e7;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="yb1TY8jY7eYrYFV5jX-Z-299" target="yb1TY8jY7eYrYFV5jX-Z-298" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1530" y="640" as="targetPoint" />
            <Array as="points">
              <mxPoint x="460" y="2100" />
              <mxPoint x="1520" y="2100" />
              <mxPoint x="1520" y="115" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="yb1TY8jY7eYrYFV5jX-Z-313" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;startArrow=oval;startFill=1;strokeColor=#9673a6;fillColor=#e1d5e7;dashed=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="yb1TY8jY7eYrYFV5jX-Z-297" target="yb1TY8jY7eYrYFV5jX-Z-312" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="460" y="2120" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="yb1TY8jY7eYrYFV5jX-Z-299" value="&lt;span&gt;&lt;div&gt;&lt;font color=&quot;#ffb570&quot;&gt;frameworks\base\core\java\android\content\pm\PackageInstaller.java&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; public int createSession(@NonNull SessionParams params) throws IOException {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; try {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; final String installerPackage;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (params.installerPackageName == null) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; installerPackage = mInstallerPackageName;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; } else {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; installerPackage = params.installerPackageName;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return mInstaller.createSession(params, installerPackage, mUserId);&lt;/div&gt;&lt;/font&gt;&lt;/div&gt;&lt;/span&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;shadow=0;glass=0;comic=0;startSize=20;labelPosition=center;verticalLabelPosition=middle;horizontal=1;fontColor=#000000;movable=1;resizable=1;rotatable=1;deletable=1;editable=1;connectable=1;" parent="1" vertex="1">
          <mxGeometry x="400" y="1920" width="120" height="160" as="geometry" />
        </mxCell>
        <mxCell id="yb1TY8jY7eYrYFV5jX-Z-308" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;startArrow=oval;startFill=1;strokeColor=#9673a6;fillColor=#e1d5e7;" parent="1" source="yb1TY8jY7eYrYFV5jX-Z-305" target="yb1TY8jY7eYrYFV5jX-Z-307" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="yb1TY8jY7eYrYFV5jX-Z-305" value="&lt;div&gt;&lt;font color=&quot;#ffb570&quot;&gt;frameworks\base\services\core\java\com\android\server\pm\PackageInstallerService.java&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&amp;nbsp; &amp;nbsp; private int createSessionInternal(SessionParams params, String installerPackageName, int userId)&lt;/div&gt;&lt;div style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; throws IOException {&lt;/div&gt;&lt;div style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; android.util.SeempLog.record(90);&lt;/div&gt;&lt;div style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; params.installFlags &amp;amp;= ~PackageManager.INSTALL_FROM_ADB;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; params.installFlags &amp;amp;= ~PackageManager.INSTALL_ALL_USERS;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; params.installFlags &amp;amp;= ~PackageManager.INSTALL_ALLOW_TEST;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; params.installFlags |= PackageManager.INSTALL_REPLACE_EXISTING;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;font color=&quot;#009900&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; // If caller requested explicit location, sanity check it, otherwise&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#009900&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; // resolve the best internal or adopted location.&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if ((params.installFlags &amp;amp; PackageManager.INSTALL_INTERNAL) != 0) {&lt;/div&gt;&lt;div style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&lt;span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; } else if ((params.installFlags &amp;amp; PackageManager.INSTALL_FORCE_VOLUME_UUID) != 0) {&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&lt;span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; } else {&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; params.installFlags |= PackageManager.INSTALL_INTERNAL;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; synchronized (mSessions) {&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;font color=&quot;#ff0000&quot;&gt;sessionId &lt;/font&gt;= allocateSessionIdLocked();&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/font&gt;session &lt;font color=&quot;#999999&quot;&gt;= new PackageInstallerSession(mInternalCallback, mContext, mPm, this,&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; mInstallThread.getLooper(), mStagingManager, sessionId, userId,&lt;/div&gt;&lt;div style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; installerPackageName, callingUid, params, createdMillis, stageDir, stageCid, false,&lt;/div&gt;&lt;div style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; false, false, null, SessionInfo.INVALID_ID, false, false, false,&lt;/div&gt;&lt;div style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; SessionInfo.STAGED_SESSION_NO_ERROR, &quot;&quot;);&lt;/div&gt;&lt;div&gt;&lt;div style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; synchronized (mSessions) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; mSessions.put(&lt;font color=&quot;#ff0000&quot;&gt;sessionId&lt;/font&gt;, &lt;font color=&quot;#ff0000&quot;&gt;session&lt;/font&gt;);&lt;/div&gt;&lt;div style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; writeSessionsAsync();&lt;/div&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;shadow=0;glass=0;comic=0;startSize=20;labelPosition=center;verticalLabelPosition=middle;horizontal=1;fontColor=#000000;movable=1;resizable=1;rotatable=1;deletable=1;editable=1;connectable=1;" parent="1" vertex="1">
          <mxGeometry x="1720" y="150" width="120" height="370" as="geometry" />
        </mxCell>
        <mxCell id="yb1TY8jY7eYrYFV5jX-Z-311" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;startArrow=oval;startFill=1;strokeColor=#9673a6;fillColor=#e1d5e7;" parent="1" source="yb1TY8jY7eYrYFV5jX-Z-307" target="yb1TY8jY7eYrYFV5jX-Z-309" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="yb1TY8jY7eYrYFV5jX-Z-307" value="&lt;div&gt;&lt;font color=&quot;#ffb570&quot;&gt;frameworks\base\services\core\java\com\android\server\pm\PackageInstallerService.java&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; private void writeSessionsAsync() {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; IoThread.getHandler().post(new Runnable() {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; @Override&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; public void run() {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; synchronized (mSessions) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; writeSessionsLocked();&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;shadow=0;glass=0;comic=0;startSize=20;labelPosition=center;verticalLabelPosition=middle;horizontal=1;fontColor=#000000;movable=1;resizable=1;rotatable=1;deletable=1;editable=1;connectable=1;" parent="1" vertex="1">
          <mxGeometry x="1840" y="520" width="120" height="110" as="geometry" />
        </mxCell>
        <mxCell id="yb1TY8jY7eYrYFV5jX-Z-309" value="&lt;div&gt;&lt;font color=&quot;#ffb570&quot;&gt;frameworks\base\services\core\java\com\android\server\pm\PackageInstallerService.java&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; private void writeSessionsLocked() {&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;mSessionsFile&lt;span style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;.finishWrite(fos);&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;shadow=0;glass=0;comic=0;startSize=20;labelPosition=center;verticalLabelPosition=middle;horizontal=1;fontColor=#000000;movable=1;resizable=1;rotatable=1;deletable=1;editable=1;connectable=1;" parent="1" vertex="1">
          <mxGeometry x="1960" y="640" width="120" height="50" as="geometry" />
        </mxCell>
        <mxCell id="yb1TY8jY7eYrYFV5jX-Z-310" value="&lt;span&gt;&lt;div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; mSessionsFile = new AtomicFile(&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; new File(Environment.getDataSystemDirectory(), &quot;install_sessions.xml&quot;),&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &quot;package-session&quot;);&lt;/div&gt;&lt;/div&gt;&lt;/span&gt;" style="text;html=1;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=top;rounded=1;shadow=0;glass=0;comic=0;startSize=20;labelPosition=center;verticalLabelPosition=middle;horizontal=1;movable=1;resizable=1;rotatable=1;deletable=1;editable=1;connectable=1;arcSize=14;" parent="1" vertex="1">
          <mxGeometry x="2190" y="670" width="460" height="50" as="geometry" />
        </mxCell>
        <mxCell id="yb1TY8jY7eYrYFV5jX-Z-315" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;startArrow=oval;startFill=1;strokeColor=#9673a6;fillColor=#e1d5e7;" parent="1" source="yb1TY8jY7eYrYFV5jX-Z-312" target="yb1TY8jY7eYrYFV5jX-Z-314" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="yb1TY8jY7eYrYFV5jX-Z-312" value="&lt;span&gt;&lt;div&gt;&lt;font color=&quot;#ffb570&quot;&gt;frameworks\base\packages\PackageInstaller\src\com\android\packageinstaller\InstallInstalling.java&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; protected void onResume() {&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; super.onResume();&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; // This is the first onResume in a single life of the activity&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (mInstallingTask == null) {&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; PackageInstaller installer = getPackageManager().getPackageInstaller();&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; PackageInstaller.SessionInfo sessionInfo = installer.getSessionInfo(mSessionId);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (sessionInfo != null &amp;amp;&amp;amp; !sessionInfo.isActive()) {&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; mInstallingTask = new InstallingAsyncTask();&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; mInstallingTask.execute();&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;/span&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;shadow=0;glass=0;comic=0;startSize=20;labelPosition=center;verticalLabelPosition=middle;horizontal=1;fontColor=#000000;movable=1;resizable=1;rotatable=1;deletable=1;editable=1;connectable=1;" parent="1" vertex="1">
          <mxGeometry x="280" y="2150" width="120" height="180" as="geometry" />
        </mxCell>
        <mxCell id="yb1TY8jY7eYrYFV5jX-Z-317" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;startArrow=oval;startFill=1;strokeColor=#9673a6;fillColor=#e1d5e7;" parent="1" source="yb1TY8jY7eYrYFV5jX-Z-314" target="yb1TY8jY7eYrYFV5jX-Z-316" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="yb1TY8jY7eYrYFV5jX-Z-314" value="&lt;div&gt;&lt;font color=&quot;#ffb570&quot;&gt;frameworks\base\packages\PackageInstaller\src\com\android\packageinstaller\InstallInstalling.java&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; private final class InstallingAsyncTask extends AsyncTask&amp;lt;Void, Void,&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; PackageInstaller.Session&amp;gt; {&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; @Override&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; protected PackageInstaller.Session doInBackground(Void... params) {&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; PackageInstaller.Session session;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; try {&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; session = getPackageManager().getPackageInstaller().openSession(mSessionId);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; try {&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; File file = new File(mPackageURI.getPath());&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; try (InputStream in = new FileInputStream(file)) {&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; long sizeBytes = file.length();&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; try (OutputStream out = &lt;/font&gt;session&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; .openWrite(&quot;PackageInstaller&quot;, 0, sizeBytes)&lt;font color=&quot;#999999&quot;&gt;) {&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;shadow=0;glass=0;comic=0;startSize=20;labelPosition=center;verticalLabelPosition=middle;horizontal=1;fontColor=#000000;movable=1;resizable=1;rotatable=1;deletable=1;editable=1;connectable=1;" parent="1" vertex="1">
          <mxGeometry x="400" y="2330" width="120" height="210" as="geometry" />
        </mxCell>
        <mxCell id="yb1TY8jY7eYrYFV5jX-Z-319" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;startArrow=oval;startFill=1;strokeColor=#9673a6;fillColor=#e1d5e7;" parent="1" source="yb1TY8jY7eYrYFV5jX-Z-316" target="yb1TY8jY7eYrYFV5jX-Z-318" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="580" y="2680" />
              <mxPoint x="1530" y="2680" />
              <mxPoint x="1530" y="870" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="yb1TY8jY7eYrYFV5jX-Z-316" value="&lt;div&gt;&lt;font color=&quot;#ffb570&quot;&gt;frameworks\base\core\java\android\content\pm\PackageInstaller.java&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; public @NonNull OutputStream openWrite(@NonNull String name, long offsetBytes,&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; long lengthBytes) throws IOException {&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; try {&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (ENABLE_REVOCABLE_FD) {&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; } else {&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; final ParcelFileDescriptor clientSocket = &lt;/font&gt;mSession.openWrite(name,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; offsetBytes, lengthBytes)&lt;font color=&quot;#999999&quot;&gt;;&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;shadow=0;glass=0;comic=0;startSize=20;labelPosition=center;verticalLabelPosition=middle;horizontal=1;fontColor=#000000;movable=1;resizable=1;rotatable=1;deletable=1;editable=1;connectable=1;" parent="1" vertex="1">
          <mxGeometry x="520" y="2540" width="120" height="120" as="geometry" />
        </mxCell>
        <mxCell id="i1vUA5VbuJyoAnAU0n23-287" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;startArrow=oval;startFill=1;strokeColor=#9673a6;fillColor=#e1d5e7;" edge="1" parent="1" source="yb1TY8jY7eYrYFV5jX-Z-318" target="yb1TY8jY7eYrYFV5jX-Z-320">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="yb1TY8jY7eYrYFV5jX-Z-318" value="&lt;span&gt;&lt;div&gt;&lt;font color=&quot;#ffb570&quot;&gt;frameworks\base\services\core\java\com\android\server\pm\PackageInstallerSession.java&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; public ParcelFileDescriptor openWrite(String name, long offsetBytes, long lengthBytes) {&lt;/div&gt;&lt;div&gt;&lt;span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return doWriteInternal(name, offsetBytes, lengthBytes, null);&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;/font&gt;&lt;/div&gt;&lt;/span&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;shadow=0;glass=0;comic=0;startSize=20;labelPosition=center;verticalLabelPosition=middle;horizontal=1;fontColor=#000000;movable=1;resizable=1;rotatable=1;deletable=1;editable=1;connectable=1;" parent="1" vertex="1">
          <mxGeometry x="1600" y="840" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="i1vUA5VbuJyoAnAU0n23-289" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;startArrow=oval;startFill=1;strokeColor=#9673a6;fillColor=#e1d5e7;" edge="1" parent="1" source="yb1TY8jY7eYrYFV5jX-Z-320" target="i1vUA5VbuJyoAnAU0n23-288">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="yb1TY8jY7eYrYFV5jX-Z-320" value="&lt;span&gt;&lt;div&gt;&lt;font color=&quot;#ffb570&quot;&gt;frameworks\base\services\core\java\com\android\server\pm\PackageInstallerSession.java&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; protected ParcelFileDescriptor doWriteInternal(String name, long offsetBytes, long lengthBytes,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; ParcelFileDescriptor incomingFd, boolean fdTrusted) throws IOException {&lt;/div&gt;&lt;div&gt;&lt;span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; synchronized (mLock) {&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (PackageInstaller.ENABLE_REVOCABLE_FD) {&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; } else {&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; fd = null;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; bridge = new FileBridge();&lt;br&gt;&lt;/div&gt;&lt;/font&gt;&lt;/div&gt;&lt;/span&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;shadow=0;glass=0;comic=0;startSize=20;labelPosition=center;verticalLabelPosition=middle;horizontal=1;fontColor=#000000;movable=1;resizable=1;rotatable=1;deletable=1;editable=1;connectable=1;" parent="1" vertex="1">
          <mxGeometry x="1720" y="900" width="120" height="120" as="geometry" />
        </mxCell>
        <mxCell id="i1vUA5VbuJyoAnAU0n23-291" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.75;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;startArrow=oval;startFill=1;strokeColor=#9673a6;fillColor=#e1d5e7;" edge="1" parent="1" source="i1vUA5VbuJyoAnAU0n23-288" target="i1vUA5VbuJyoAnAU0n23-290">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="i1vUA5VbuJyoAnAU0n23-288" value="&lt;span&gt;&lt;div&gt;&lt;font color=&quot;#ffb570&quot;&gt;frameworks\base\core\java\android\os\FileBridge.java&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; private final FileDescriptor mServer = new FileDescriptor();&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; private final FileDescriptor mClient = new FileDescriptor();&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; public FileBridge() {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; try {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Os.socketpair(AF_UNIX, SOCK_STREAM, 0, mServer, mClient);&lt;/div&gt;&lt;/div&gt;&lt;/font&gt;&lt;/div&gt;&lt;/span&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;shadow=0;glass=0;comic=0;startSize=20;labelPosition=center;verticalLabelPosition=middle;horizontal=1;fontColor=#000000;movable=1;resizable=1;rotatable=1;deletable=1;editable=1;connectable=1;" vertex="1" parent="1">
          <mxGeometry x="1840" y="1025" width="120" height="95" as="geometry" />
        </mxCell>
        <mxCell id="i1vUA5VbuJyoAnAU0n23-293" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;startArrow=oval;startFill=1;strokeColor=#9673a6;fillColor=#e1d5e7;" edge="1" parent="1" source="i1vUA5VbuJyoAnAU0n23-290" target="i1vUA5VbuJyoAnAU0n23-292">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="i1vUA5VbuJyoAnAU0n23-290" value="&lt;div&gt;&lt;span style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; mBridges.add(bridge);&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; stageDir = resolveStageDirLocked();&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; try {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; target = new File(stageDir, name);&lt;/div&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; final FileDescriptor &lt;/font&gt;targetFd &lt;font color=&quot;#999999&quot;&gt;= Os.open(target.getAbsolutePath(),&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; O_CREAT | O_WRONLY, 0644);&lt;/div&gt;&lt;div style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Os.chmod(target.getAbsolutePath(), 0644);&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;shadow=0;glass=0;comic=0;startSize=20;labelPosition=center;verticalLabelPosition=middle;horizontal=1;fontColor=#000000;movable=1;resizable=1;rotatable=1;deletable=1;editable=1;connectable=1;" vertex="1" parent="1">
          <mxGeometry x="1720" y="1120" width="120" height="140" as="geometry" />
        </mxCell>
        <mxCell id="i1vUA5VbuJyoAnAU0n23-295" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.75;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;startArrow=oval;startFill=1;strokeColor=#9673a6;fillColor=#e1d5e7;" edge="1" parent="1" source="i1vUA5VbuJyoAnAU0n23-292" target="i1vUA5VbuJyoAnAU0n23-294">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="i1vUA5VbuJyoAnAU0n23-292" value="&lt;span&gt;&lt;div&gt;&lt;font color=&quot;#ffb570&quot;&gt;frameworks\base\core\java\android\os\storage\StorageManager.java&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; public void allocateBytes(FileDescriptor fd, @BytesLong long bytes,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; @RequiresPermission @AllocateFlags int flags) throws IOException {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; final File file = ParcelFileDescriptor.getFile(fd);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; final UUID uuid = getUuidForPath(file);&lt;/div&gt;&lt;div&gt;&lt;span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; try {&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Os.posix_fallocate(fd, 0, bytes);&lt;/div&gt;&lt;/font&gt;&lt;/div&gt;&lt;/span&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;shadow=0;glass=0;comic=0;startSize=20;labelPosition=center;verticalLabelPosition=middle;horizontal=1;fontColor=#000000;movable=1;resizable=1;rotatable=1;deletable=1;editable=1;connectable=1;" vertex="1" parent="1">
          <mxGeometry x="1840" y="1260" width="120" height="110" as="geometry" />
        </mxCell>
        <mxCell id="i1vUA5VbuJyoAnAU0n23-294" value="&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; bridge.setTargetFile(targetFd);&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; // MIUI ADD: START&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; int size = SystemProperties.getInt(PM_PROPERTY_INSTALLATION_BUFFER_SIZE,&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; DEFAULT_FILEBRIDGE_READ_BUFFER_SIZE);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; bridge.setReadBufferSize(size);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; // END&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; bridge.start();&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return new ParcelFileDescriptor(bridge.getClientSocket());&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;shadow=0;glass=0;comic=0;startSize=20;labelPosition=center;verticalLabelPosition=middle;horizontal=1;fontColor=#000000;movable=1;resizable=1;rotatable=1;deletable=1;editable=1;connectable=1;" vertex="1" parent="1">
          <mxGeometry x="1720" y="1370" width="120" height="120" as="geometry" />
        </mxCell>
        <mxCell id="i1vUA5VbuJyoAnAU0n23-296" value="&lt;span&gt;socketpair&lt;br&gt;&lt;/span&gt;" style="text;html=1;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=top;rounded=1;shadow=0;glass=0;comic=0;startSize=20;labelPosition=center;verticalLabelPosition=middle;horizontal=1;movable=1;resizable=1;rotatable=1;deletable=1;editable=1;connectable=1;arcSize=14;" vertex="1" parent="1">
          <mxGeometry x="1694" y="1410" width="70" height="30" as="geometry" />
        </mxCell>
        <mxCell id="i1vUA5VbuJyoAnAU0n23-302" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;startArrow=oval;startFill=1;strokeColor=#9673a6;fillColor=#e1d5e7;" edge="1" parent="1" source="i1vUA5VbuJyoAnAU0n23-297" target="i1vUA5VbuJyoAnAU0n23-301">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="i1vUA5VbuJyoAnAU0n23-297" value="&lt;div&gt;&lt;span style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; byte[] buffer = new byte[1024 * 1024];&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; while (true) {&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; out.write(buffer, 0, numRead);&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;shadow=0;glass=0;comic=0;startSize=20;labelPosition=center;verticalLabelPosition=middle;horizontal=1;fontColor=#000000;movable=1;resizable=1;rotatable=1;deletable=1;editable=1;connectable=1;" vertex="1" parent="1">
          <mxGeometry x="400" y="2760" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="i1vUA5VbuJyoAnAU0n23-298" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;startArrow=oval;startFill=1;strokeColor=#9673a6;fillColor=#e1d5e7;dashed=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="yb1TY8jY7eYrYFV5jX-Z-316" target="i1vUA5VbuJyoAnAU0n23-299">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="210" y="2520" as="sourcePoint" />
            <mxPoint x="250" y="2780" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="i1vUA5VbuJyoAnAU0n23-300" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.75;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;startArrow=oval;startFill=1;strokeColor=#9673a6;fillColor=#e1d5e7;" edge="1" parent="1" source="i1vUA5VbuJyoAnAU0n23-299" target="i1vUA5VbuJyoAnAU0n23-297">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="i1vUA5VbuJyoAnAU0n23-299" value="&lt;div&gt;&lt;span style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return new FileBridge.FileBridgeOutputStream(clientSocket);&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;shadow=0;glass=0;comic=0;startSize=20;labelPosition=center;verticalLabelPosition=middle;horizontal=1;fontColor=#000000;movable=1;resizable=1;rotatable=1;deletable=1;editable=1;connectable=1;" vertex="1" parent="1">
          <mxGeometry x="520" y="2710" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="i1vUA5VbuJyoAnAU0n23-304" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;startArrow=oval;startFill=1;strokeColor=#9673a6;fillColor=#e1d5e7;" edge="1" parent="1" source="i1vUA5VbuJyoAnAU0n23-301" target="i1vUA5VbuJyoAnAU0n23-303">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="i1vUA5VbuJyoAnAU0n23-301" value="&lt;div&gt;&lt;font color=&quot;#ffb570&quot;&gt;frameworks\base\packages\PackageInstaller\src\com\android\packageinstaller\InstallInstalling.java&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; protected void onPostExecute(PackageInstaller.Session session) {&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (session != null) {&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Intent broadcastIntent = new Intent(BROADCAST_ACTION);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; broadcastIntent.setFlags(Intent.FLAG_RECEIVER_FOREGROUND);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; broadcastIntent.setPackage(getPackageName());&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; broadcastIntent.putExtra(EventResultPersister.EXTRA_ID, mInstallId);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; session.commit(pendingIntent.getIntentSender());&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;shadow=0;glass=0;comic=0;startSize=20;labelPosition=center;verticalLabelPosition=middle;horizontal=1;fontColor=#000000;movable=1;resizable=1;rotatable=1;deletable=1;editable=1;connectable=1;" vertex="1" parent="1">
          <mxGeometry x="400" y="2850" width="120" height="140" as="geometry" />
        </mxCell>
        <mxCell id="i1vUA5VbuJyoAnAU0n23-308" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;startArrow=oval;startFill=1;strokeColor=#9673a6;fillColor=#e1d5e7;" edge="1" parent="1" source="i1vUA5VbuJyoAnAU0n23-303" target="i1vUA5VbuJyoAnAU0n23-305">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="580" y="3090" />
              <mxPoint x="1540" y="3090" />
              <mxPoint x="1540" y="1535" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="i1vUA5VbuJyoAnAU0n23-303" value="&lt;div&gt;&lt;font color=&quot;#ffb570&quot;&gt;frameworks\base\core\java\android\content\pm\PackageInstaller.java&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; public void commit(@NonNull IntentSender statusReceiver) {&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; try {&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; mSession.commit(statusReceiver, false);&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;shadow=0;glass=0;comic=0;startSize=20;labelPosition=center;verticalLabelPosition=middle;horizontal=1;fontColor=#000000;movable=1;resizable=1;rotatable=1;deletable=1;editable=1;connectable=1;" vertex="1" parent="1">
          <mxGeometry x="520" y="3000" width="120" height="70" as="geometry" />
        </mxCell>
        <mxCell id="i1vUA5VbuJyoAnAU0n23-307" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;startArrow=oval;startFill=1;strokeColor=#9673a6;fillColor=#e1d5e7;" edge="1" parent="1" source="i1vUA5VbuJyoAnAU0n23-305" target="i1vUA5VbuJyoAnAU0n23-306">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="i1vUA5VbuJyoAnAU0n23-305" value="&lt;span&gt;&lt;div&gt;&lt;font color=&quot;#ffb570&quot;&gt;frameworks\base\services\core\java\com\android\server\pm\PackageInstallerSession.java&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; public void commit(@NonNull IntentSender statusReceiver, boolean forTransfer) {&lt;/div&gt;&lt;div&gt;&lt;span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return doWriteInternal(name, offsetBytes, lengthBytes, null);&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;/font&gt;&lt;/div&gt;&lt;/span&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;shadow=0;glass=0;comic=0;startSize=20;labelPosition=center;verticalLabelPosition=middle;horizontal=1;fontColor=#000000;movable=1;resizable=1;rotatable=1;deletable=1;editable=1;connectable=1;" vertex="1" parent="1">
          <mxGeometry x="1600" y="1520" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="i1vUA5VbuJyoAnAU0n23-311" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;startArrow=oval;startFill=1;strokeColor=#9673a6;fillColor=#e1d5e7;" edge="1" parent="1" source="i1vUA5VbuJyoAnAU0n23-306" target="i1vUA5VbuJyoAnAU0n23-309">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="i1vUA5VbuJyoAnAU0n23-306" value="&lt;span&gt;&lt;div&gt;&lt;font color=&quot;#ffb570&quot;&gt;frameworks\base\services\core\java\com\android\server\pm\PackageInstallerSession.java&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; public void commit(@NonNull IntentSender statusReceiver, boolean forTransfer) {&lt;/div&gt;&lt;div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (!markAsCommitted(statusReceiver, forTransfer)) {&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/font&gt;&lt;/div&gt;&lt;/span&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;shadow=0;glass=0;comic=0;startSize=20;labelPosition=center;verticalLabelPosition=middle;horizontal=1;fontColor=#000000;movable=1;resizable=1;rotatable=1;deletable=1;editable=1;connectable=1;" vertex="1" parent="1">
          <mxGeometry x="1720" y="1590" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="i1vUA5VbuJyoAnAU0n23-312" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.75;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;startArrow=oval;startFill=1;strokeColor=#9673a6;fillColor=#e1d5e7;" edge="1" parent="1" source="i1vUA5VbuJyoAnAU0n23-309" target="i1vUA5VbuJyoAnAU0n23-310">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="i1vUA5VbuJyoAnAU0n23-309" value="&lt;span&gt;&lt;div&gt;&lt;font color=&quot;#ffb570&quot;&gt;frameworks\base\services\core\java\com\android\server\pm\PackageInstallerSession.java&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&lt;div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; public boolean markAsCommitted(&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; @NonNull IntentSender statusReceiver, boolean forTransfer) {&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; synchronized (mLock) {&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; mCommitted = true;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/font&gt;&lt;/div&gt;&lt;/span&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;shadow=0;glass=0;comic=0;startSize=20;labelPosition=center;verticalLabelPosition=middle;horizontal=1;fontColor=#000000;movable=1;resizable=1;rotatable=1;deletable=1;editable=1;connectable=1;" vertex="1" parent="1">
          <mxGeometry x="1840" y="1650" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="i1vUA5VbuJyoAnAU0n23-314" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;startArrow=oval;startFill=1;strokeColor=#9673a6;fillColor=#e1d5e7;" edge="1" parent="1" source="i1vUA5VbuJyoAnAU0n23-310" target="i1vUA5VbuJyoAnAU0n23-313">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="i1vUA5VbuJyoAnAU0n23-310" value="&lt;div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; mHandler.obtainMessage(&lt;/font&gt;&lt;font color=&quot;#009900&quot;&gt;MSG_COMMIT&lt;/font&gt;&lt;font color=&quot;#999999&quot;&gt;).sendToTarget();&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;shadow=0;glass=0;comic=0;startSize=20;labelPosition=center;verticalLabelPosition=middle;horizontal=1;fontColor=#000000;movable=1;resizable=1;rotatable=1;deletable=1;editable=1;connectable=1;" vertex="1" parent="1">
          <mxGeometry x="1720" y="1740" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="i1vUA5VbuJyoAnAU0n23-316" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;startArrow=oval;startFill=1;strokeColor=#9673a6;fillColor=#e1d5e7;" edge="1" parent="1" source="i1vUA5VbuJyoAnAU0n23-313" target="i1vUA5VbuJyoAnAU0n23-315">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="i1vUA5VbuJyoAnAU0n23-313" value="&lt;span&gt;&lt;div&gt;&lt;font color=&quot;#ffb570&quot;&gt;frameworks\base\services\core\java\com\android\server\pm\PackageInstallerSession.java&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&lt;div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; private final Handler.Callback mHandlerCallback = new Handler.Callback() {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; @Override&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; public boolean handleMessage(Message msg) {&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; switch (msg.what) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; case MSG_COMMIT:&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; handleCommit();&lt;/div&gt;&lt;/div&gt;&lt;/font&gt;&lt;/div&gt;&lt;/span&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;shadow=0;glass=0;comic=0;startSize=20;labelPosition=center;verticalLabelPosition=middle;horizontal=1;fontColor=#000000;movable=1;resizable=1;rotatable=1;deletable=1;editable=1;connectable=1;" vertex="1" parent="1">
          <mxGeometry x="1720" y="1800" width="120" height="110" as="geometry" />
        </mxCell>
        <mxCell id="i1vUA5VbuJyoAnAU0n23-318" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;startArrow=oval;startFill=1;strokeColor=#9673a6;fillColor=#e1d5e7;" edge="1" parent="1" source="i1vUA5VbuJyoAnAU0n23-315" target="i1vUA5VbuJyoAnAU0n23-317">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="i1vUA5VbuJyoAnAU0n23-315" value="&lt;span&gt;&lt;div&gt;&lt;font color=&quot;#ffb570&quot;&gt;frameworks\base\services\core\java\com\android\server\pm\PackageInstallerSession.java&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; private void handleCommit() {&lt;/div&gt;&lt;div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; try {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; synchronized (mLock) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; commitNonStagedLocked(childSessions);&lt;/div&gt;&lt;/div&gt;&lt;/font&gt;&lt;/div&gt;&lt;/span&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;shadow=0;glass=0;comic=0;startSize=20;labelPosition=center;verticalLabelPosition=middle;horizontal=1;fontColor=#000000;movable=1;resizable=1;rotatable=1;deletable=1;editable=1;connectable=1;" vertex="1" parent="1">
          <mxGeometry x="1840" y="1910" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="i1vUA5VbuJyoAnAU0n23-320" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;startArrow=oval;startFill=1;strokeColor=#9673a6;fillColor=#e1d5e7;" edge="1" parent="1" source="i1vUA5VbuJyoAnAU0n23-317" target="i1vUA5VbuJyoAnAU0n23-319">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="i1vUA5VbuJyoAnAU0n23-317" value="&lt;span&gt;&lt;div&gt;&lt;font color=&quot;#ffb570&quot;&gt;frameworks\base\services\core\java\com\android\server\pm\PackageInstallerSession.java&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; private void commitNonStagedLocked(List&amp;lt;PackageInstallerSession&amp;gt; childSessions)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; throws PackageManagerException {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; final PackageManagerService.ActiveInstallSession committingSession =&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; makeSessionActiveLocked();&lt;/div&gt;&lt;/font&gt;&lt;/div&gt;&lt;/span&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;shadow=0;glass=0;comic=0;startSize=20;labelPosition=center;verticalLabelPosition=middle;horizontal=1;fontColor=#000000;movable=1;resizable=1;rotatable=1;deletable=1;editable=1;connectable=1;" vertex="1" parent="1">
          <mxGeometry x="1960" y="1990" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="i1vUA5VbuJyoAnAU0n23-323" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;startArrow=oval;startFill=1;strokeColor=#9673a6;fillColor=#e1d5e7;" edge="1" parent="1" source="i1vUA5VbuJyoAnAU0n23-319" target="i1vUA5VbuJyoAnAU0n23-321">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="i1vUA5VbuJyoAnAU0n23-319" value="&lt;span&gt;&lt;div&gt;&lt;font color=&quot;#ffb570&quot;&gt;frameworks\base\services\core\java\com\android\server\pm\PackageInstallerSession.java&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; private PackageManagerService.ActiveInstallSession makeSessionActiveLocked()&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; throws PackageManagerException {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; // Unpack native libraries&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; extractNativeLibraries(mResolvedStageDir, params.abiOverride,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; mayInheritNativeLibs());&lt;/div&gt;&lt;/font&gt;&lt;/div&gt;&lt;/span&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;shadow=0;glass=0;comic=0;startSize=20;labelPosition=center;verticalLabelPosition=middle;horizontal=1;fontColor=#000000;movable=1;resizable=1;rotatable=1;deletable=1;editable=1;connectable=1;" vertex="1" parent="1">
          <mxGeometry x="2080" y="2070" width="120" height="100" as="geometry" />
        </mxCell>
        <mxCell id="i1vUA5VbuJyoAnAU0n23-328" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;startArrow=oval;startFill=1;strokeColor=#9673a6;fillColor=#e1d5e7;" edge="1" parent="1" source="i1vUA5VbuJyoAnAU0n23-321" target="i1vUA5VbuJyoAnAU0n23-324">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="i1vUA5VbuJyoAnAU0n23-321" value="&lt;span&gt;&lt;div&gt;&lt;font color=&quot;#ffb570&quot;&gt;frameworks\base\services\core\java\com\android\server\pm\PackageInstallerSession.java&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; private static void extractNativeLibraries(File packageDir, String abiOverride, boolean inherit)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; throws PackageManagerException {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; final File libDir = new File(packageDir, NativeLibraryHelper.LIB_DIR_NAME);&lt;/div&gt;&lt;div&gt;&lt;span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; try {&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; handle = NativeLibraryHelper.Handle.create(packageDir);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; final int res = NativeLibraryHelper.copyNativeBinariesWithOverride(handle, libDir,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; abiOverride);&lt;/div&gt;&lt;/font&gt;&lt;/div&gt;&lt;/span&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;shadow=0;glass=0;comic=0;startSize=20;labelPosition=center;verticalLabelPosition=middle;horizontal=1;fontColor=#000000;movable=1;resizable=1;rotatable=1;deletable=1;editable=1;connectable=1;" vertex="1" parent="1">
          <mxGeometry x="2200" y="2170" width="120" height="120" as="geometry" />
        </mxCell>
        <mxCell id="i1vUA5VbuJyoAnAU0n23-322" value="&lt;span&gt;libDir=/data/app/vmdl1871514791.tmp/lib&lt;br&gt;&lt;/span&gt;" style="text;html=1;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=top;rounded=1;shadow=0;glass=0;comic=0;startSize=20;labelPosition=center;verticalLabelPosition=middle;horizontal=1;movable=1;resizable=1;rotatable=1;deletable=1;editable=1;connectable=1;arcSize=14;" vertex="1" parent="1">
          <mxGeometry x="1980" y="2220" width="230" height="25" as="geometry" />
        </mxCell>
        <mxCell id="i1vUA5VbuJyoAnAU0n23-327" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;startArrow=oval;startFill=1;strokeColor=#9673a6;fillColor=#e1d5e7;" edge="1" parent="1" source="i1vUA5VbuJyoAnAU0n23-324" target="i1vUA5VbuJyoAnAU0n23-326">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="i1vUA5VbuJyoAnAU0n23-324" value="&lt;span&gt;&lt;div&gt;&lt;font color=&quot;#ffb570&quot;&gt;frameworks\base\core\java\com\android\internal\content\NativeLibraryHelper.java&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; public static int copyNativeBinariesWithOverride(Handle handle, File libraryRoot,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; String abiOverride) {&lt;/div&gt;&lt;div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (handle.multiArch) {&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; } else {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; String cpuAbiOverride = null;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (CLEAR_ABI_OVERRIDE.equals(abiOverride)) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; cpuAbiOverride = null;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; } else if (abiOverride != null) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; cpuAbiOverride = abiOverride;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; String[] abiList = (cpuAbiOverride != null) ?&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; new String[] { cpuAbiOverride } : Build.SUPPORTED_ABIS;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (Build.SUPPORTED_64_BIT_ABIS.length &amp;gt; 0 &amp;amp;&amp;amp; cpuAbiOverride == null &amp;amp;&amp;amp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; hasRenderscriptBitcode(handle)) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; abiList = Build.SUPPORTED_32_BIT_ABIS;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; int copyRet = copyNativeBinariesForSupportedAbi(handle, libraryRoot, abiList,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; true /* use isa specific subdirs */);&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/font&gt;&lt;/div&gt;&lt;/span&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;shadow=0;glass=0;comic=0;startSize=20;labelPosition=center;verticalLabelPosition=middle;horizontal=1;fontColor=#000000;movable=1;resizable=1;rotatable=1;deletable=1;editable=1;connectable=1;" vertex="1" parent="1">
          <mxGeometry x="2320" y="2290" width="120" height="310" as="geometry" />
        </mxCell>
        <mxCell id="i1vUA5VbuJyoAnAU0n23-325" value="&lt;span&gt;abiList=[arm64-v8a, armeabi-v7a, armeabi]&lt;br&gt;&lt;/span&gt;" style="text;html=1;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=top;rounded=1;shadow=0;glass=0;comic=0;startSize=20;labelPosition=center;verticalLabelPosition=middle;horizontal=1;movable=1;resizable=1;rotatable=1;deletable=1;editable=1;connectable=1;arcSize=14;" vertex="1" parent="1">
          <mxGeometry x="2130" y="2480" width="230" height="25" as="geometry" />
        </mxCell>
        <mxCell id="i1vUA5VbuJyoAnAU0n23-331" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;startArrow=oval;startFill=1;strokeColor=#9673a6;fillColor=#e1d5e7;" edge="1" parent="1" source="i1vUA5VbuJyoAnAU0n23-326" target="i1vUA5VbuJyoAnAU0n23-329">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="i1vUA5VbuJyoAnAU0n23-326" value="&lt;span&gt;&lt;div&gt;&lt;font color=&quot;#ffb570&quot;&gt;frameworks\base\core\java\com\android\internal\content\NativeLibraryHelper.java&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&lt;div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; public static int copyNativeBinariesForSupportedAbi(Handle handle, File libraryRoot,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; String[] abiList, boolean useIsaSubdir) throws IOException {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; createNativeLibrarySubdir(libraryRoot);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; /*&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;* If this is an internal application or our nativeLibraryPath points to&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;* the app-lib directory, unpack the libraries if necessary.&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;*/&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; int abi = findSupportedAbi(handle, abiList);&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/font&gt;&lt;/div&gt;&lt;/span&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;shadow=0;glass=0;comic=0;startSize=20;labelPosition=center;verticalLabelPosition=middle;horizontal=1;fontColor=#000000;movable=1;resizable=1;rotatable=1;deletable=1;editable=1;connectable=1;" vertex="1" parent="1">
          <mxGeometry x="2440" y="2600" width="120" height="150" as="geometry" />
        </mxCell>
        <mxCell id="i1vUA5VbuJyoAnAU0n23-332" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;startArrow=oval;startFill=1;strokeColor=#9673a6;fillColor=#e1d5e7;" edge="1" parent="1" source="i1vUA5VbuJyoAnAU0n23-329" target="i1vUA5VbuJyoAnAU0n23-330">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="i1vUA5VbuJyoAnAU0n23-329" value="&lt;span&gt;&lt;div&gt;&lt;font color=&quot;#97d077&quot;&gt;/frameworks/base/core/jni/com_android_internal_content_NativeLibraryHelper.cpp&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;508com_android_internal_content_NativeLibraryHelper_findSupportedAbi(JNIEnv *env, jclass clazz,&lt;/div&gt;&lt;div&gt;509&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; jlong apkHandle, jobjectArray javaCpuAbisToSearch, jboolean debuggable)&lt;/div&gt;&lt;div&gt;510{&lt;/div&gt;&lt;div&gt;511&amp;nbsp; &amp;nbsp; return (jint) findSupportedAbi(env, apkHandle, javaCpuAbisToSearch, debuggable);&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/font&gt;&lt;/div&gt;&lt;/span&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;shadow=0;glass=0;comic=0;startSize=20;labelPosition=center;verticalLabelPosition=middle;horizontal=1;fontColor=#000000;movable=1;resizable=1;rotatable=1;deletable=1;editable=1;connectable=1;" vertex="1" parent="1">
          <mxGeometry x="2560" y="2750" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="i1vUA5VbuJyoAnAU0n23-336" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.75;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;startArrow=oval;startFill=1;strokeColor=#9673a6;fillColor=#e1d5e7;" edge="1" parent="1" source="i1vUA5VbuJyoAnAU0n23-330" target="i1vUA5VbuJyoAnAU0n23-334">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="i1vUA5VbuJyoAnAU0n23-330" value="&lt;span&gt;&lt;div&gt;&lt;font color=&quot;#97d077&quot;&gt;/frameworks/base/core/jni/com_android_internal_content_NativeLibraryHelper.cpp&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;431static int findSupportedAbi(JNIEnv *env, jlong apkHandle, jobjectArray supportedAbisArray,&lt;/div&gt;&lt;div&gt;432&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; jboolean debuggable) {&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;452&amp;nbsp; &amp;nbsp; ZipEntryRO entry = NULL;&lt;/div&gt;&lt;div&gt;453&amp;nbsp; &amp;nbsp; int status = NO_NATIVE_LIBRARIES;&lt;/div&gt;&lt;div&gt;454&amp;nbsp; &amp;nbsp; while ((entry = it-&amp;gt;next()) != NULL) {&lt;/div&gt;&lt;div&gt;&lt;span&gt;468&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; for (int i = 0; i &amp;lt; numAbis; i++) {&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;469&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; const ScopedUtfChars* abi = supportedAbis[i];&lt;/div&gt;&lt;div&gt;470&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (abi-&amp;gt;size() == abiSize &amp;amp;&amp;amp; !strncmp(abiOffset, abi-&amp;gt;c_str(), abiSize)) {&lt;/div&gt;&lt;div&gt;471&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; // The entry that comes in first (i.e. with a lower index) has the higher priority.&lt;/div&gt;&lt;div&gt;472&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (((i &amp;lt; status) &amp;amp;&amp;amp; (status &amp;gt;= 0)) || (status &amp;lt; 0) ) {&lt;/div&gt;&lt;div&gt;473&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; status = i;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/font&gt;&lt;/div&gt;&lt;/span&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;shadow=0;glass=0;comic=0;startSize=20;labelPosition=center;verticalLabelPosition=middle;horizontal=1;fontColor=#000000;movable=1;resizable=1;rotatable=1;deletable=1;editable=1;connectable=1;" vertex="1" parent="1">
          <mxGeometry x="2680" y="2830" width="120" height="180" as="geometry" />
        </mxCell>
        <mxCell id="i1vUA5VbuJyoAnAU0n23-333" value="&lt;span&gt;遍历apk的entry，&lt;br&gt;找到系统支持abi最靠前的那个entry，&lt;br&gt;以此觉得该apk的abi&lt;br&gt;&lt;/span&gt;" style="text;html=1;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=top;rounded=1;shadow=0;glass=0;comic=0;startSize=20;labelPosition=center;verticalLabelPosition=middle;horizontal=1;movable=1;resizable=1;rotatable=1;deletable=1;editable=1;connectable=1;arcSize=14;" vertex="1" parent="1">
          <mxGeometry x="2440" y="2900" width="230" height="60" as="geometry" />
        </mxCell>
        <mxCell id="i1vUA5VbuJyoAnAU0n23-337" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;startArrow=oval;startFill=1;strokeColor=#9673a6;fillColor=#e1d5e7;" edge="1" parent="1" source="i1vUA5VbuJyoAnAU0n23-334" target="i1vUA5VbuJyoAnAU0n23-335">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="i1vUA5VbuJyoAnAU0n23-334" value="&lt;span&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (abi &amp;gt;= 0) {&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&lt;div&gt;&lt;div&gt;&lt;span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; int copyRet = copyNativeBinaries(handle, subDir, abiList[abi]);&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/font&gt;&lt;/div&gt;&lt;/span&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;shadow=0;glass=0;comic=0;startSize=20;labelPosition=center;verticalLabelPosition=middle;horizontal=1;fontColor=#000000;movable=1;resizable=1;rotatable=1;deletable=1;editable=1;connectable=1;" vertex="1" parent="1">
          <mxGeometry x="2440" y="3010" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="i1vUA5VbuJyoAnAU0n23-340" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.75;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;startArrow=oval;startFill=1;strokeColor=#9673a6;fillColor=#e1d5e7;" edge="1" parent="1" source="i1vUA5VbuJyoAnAU0n23-335" target="i1vUA5VbuJyoAnAU0n23-339">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="i1vUA5VbuJyoAnAU0n23-335" value="&lt;span&gt;&lt;div&gt;&lt;font color=&quot;#ffb570&quot;&gt;frameworks\base\core\java\com\android\internal\content\NativeLibraryHelper.java&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; public static int copyNativeBinaries(Handle handle, File sharedLibraryDir, String abi) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; for (long apkHandle : handle.apkHandles) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; int res = nativeCopyNativeBinaries(apkHandle, sharedLibraryDir.getPath(), abi,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; handle.extractNativeLibs, handle.debuggable);&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/font&gt;&lt;/div&gt;&lt;/span&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;shadow=0;glass=0;comic=0;startSize=20;labelPosition=center;verticalLabelPosition=middle;horizontal=1;fontColor=#000000;movable=1;resizable=1;rotatable=1;deletable=1;editable=1;connectable=1;" vertex="1" parent="1">
          <mxGeometry x="2560" y="3050" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="i1vUA5VbuJyoAnAU0n23-338" value="&lt;span&gt;sharedLibraryDir=/data/app/vmdl1871514791.tmp/lib/arm64&lt;br&gt;abi=arm64-v8a&lt;br&gt;&lt;/span&gt;" style="text;html=1;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=top;rounded=1;shadow=0;glass=0;comic=0;startSize=20;labelPosition=center;verticalLabelPosition=middle;horizontal=1;movable=1;resizable=1;rotatable=1;deletable=1;editable=1;connectable=1;arcSize=14;" vertex="1" parent="1">
          <mxGeometry x="2900" y="3120" width="330" height="40" as="geometry" />
        </mxCell>
        <mxCell id="i1vUA5VbuJyoAnAU0n23-339" value="&lt;span&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(153 , 153 , 153)&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return new PackageManagerService.ActiveInstallSession(mPackageName, stageDir,&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#999999&quot;&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; localObserver, params, mInstallerPackageName, mInstallerUid, user,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; // MIUI MOD:&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; // mSigningDetails);&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; mSigningDetails, mStatistic);&lt;/div&gt;&lt;/font&gt;&lt;/div&gt;&lt;/span&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;shadow=0;glass=0;comic=0;startSize=20;labelPosition=center;verticalLabelPosition=middle;horizontal=1;fontColor=#000000;movable=1;resizable=1;rotatable=1;deletable=1;editable=1;connectable=1;" vertex="1" parent="1">
          <mxGeometry x="2080" y="3150" width="120" height="80" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
